<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block title %}Compose Music!{% endblock %}</title>
  <style>
    /* (Your existing CSS unchanged) */
    html, body { height:100%; margin:0; padding:0; }
    body { display:flex; flex-direction:column; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color:#f9f9f9; color:#333; padding-top:60px; }
    nav { background-color:#333; position:fixed; top:0; left:0; right:0; height:60px; display:flex; align-items:center; z-index:1000; }
    nav ul { list-style:none; margin:0 auto; padding:0; display:flex; }
    nav li { margin:0 20px; }
    nav a { color:#fff; text-decoration:none; padding:15px 20px; display:inline-block; transition:background 0.3s; }
    nav a:hover { background-color:#555; border-radius:5px; }
    main { flex:1; text-align:center; padding:20px; }
    h1 { font-size:2.5em; margin-bottom:1rem; }
    .keyboard { display:flex; justify-content:center; flex-wrap:wrap; margin:20px auto; max-width:500px; }
    .key { padding:20px; margin:8px; background-color:#007bff; color:white; border:none; border-radius:8px; cursor:pointer; font-size:18px; width:60px; text-align:center; transition:background 0.3s; }
    .key:hover { background-color:#0056b3; }
    .controls { margin:20px; }
    .controls button { padding:10px 25px; margin:10px; font-size:16px; background-color:#28a745; color:white; border:none; border-radius:6px; cursor:pointer; transition:background 0.3s; }
    .controls button:hover { background-color:#218838; }
    .composition { font-size:18px; margin-top:10px; }
    audio { margin-top:20px; width:100%; max-width:600px; background:#eee; border-radius:8px; }
    #login, #signup { max-width:400px; margin:40px auto; background:#fff; padding:25px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); text-align:left; }
    #login h2, #signup h2 { text-align:center; margin-bottom:15px; }
    form .messages { color:red; text-align:center; margin-bottom:10px; }
    form button { margin-top:10px; padding:10px 20px; background:#007bff; border:none; color:white; border-radius:5px; cursor:pointer; width:100%; }
    form button:hover { background:#0056b3; }
    footer { background:#e9e9e9; padding:20px; text-align:center; }
    .signout-button { background:#f44336; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; transition:background 0.3s; }
    .signout-button:hover { background:#d32f2f; }
    footer a { color:#007bff; text-decoration:none; font-weight:bold; }
    footer a:hover { text-decoration:underline; }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav>
    <ul>
      <li><a href="#home">Home</a></li>
      {% if user.is_authenticated %}
        <li><a href="{% url 'second_page' %}">Notes</a></li>
      {% else %}
        <li><a href="{% url 'login_page' %}">Login</a></li>
        <li><a href="{% url 'signup' %}">Sign Up</a></li>
        <li><a href="{% url 'second_page' %}">Notes</a></li>
      {% endif %}
    </ul>
  </nav>

  <!-- Main Content -->
  <main id="home">
    <h1>Compose Your Music ðŸŽ¶</h1>

    <div class="keyboard">
      <button class="key" onclick="addNoteAndPlay('C')">C</button>
      <button class="key" onclick="addNoteAndPlay('D')">D</button>
      <button class="key" onclick="addNoteAndPlay('E')">E</button>
      <button class="key" onclick="addNoteAndPlay('F')">F</button>
      <button class="key" onclick="addNoteAndPlay('G')">G</button>
      <button class="key" onclick="addNoteAndPlay('A')">A</button>
      <button class="key" onclick="addNoteAndPlay('B')">B</button>
    </div>

    <div class="controls">
      <button id="play-btn">Play Composition</button>
      <button id="save-btn">Save Composition</button>
      <button id="new-btn">New Composition</button>
    </div>

    <div class="composition" id="composition">
      Current Composition: None
    </div>

    <!-- Audio Player -->
    <audio id="audio-player" controls preload="none"></audio>

    <!-- Login Section -->
    <div id="login">
      <h2>Login</h2>
      {% if messages %}
        <div class="messages">
          {% for message in messages %}
            <p>{{ message }}</p>
          {% endfor %}
        </div>
      {% endif %}
      <form method="POST">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Login</button>
      </form>
      <p>Don't have an account? <a href="{% url 'signup' %}">Sign up here</a></p>
    </div>

    <!-- Signup Section -->
    <div id="signup">
      <h2>Create an Account</h2>
      {% if messages %}
        <div class="messages">
          {% for message in messages %}
            <p>{{ message }}</p>
          {% endfor %}
        </div>
      {% endif %}
      <form method="POST">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Sign Up</button>
      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer>
    <h2>Created By Frank Jakob</h2>
    <h3>
      Want to save your music? Make an account.<br>
      <a href="{% url 'login_page' %}">Click here to login</a> |
      <a href="{% url 'signup' %}">Don't have an account? Make one here!</a>
    </h3>
    {% if user.is_authenticated %}
      <p><a href="{% url 'post_message' %}">Forum</a></p>
      <form method="POST" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="signout-button">Sign Out</button>
      </form>
    {% endif %}
  </footer>
//script goes here
  {% load static %}
  <script>
    // CSRF helper
    function getCookie(name) {
      const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
      return match ? match[2] : null;
    }
  
    let composition = [];
  
    function addNoteAndPlay(note) {
      composition.push(note);
      document.getElementById('composition').textContent = 
        `Current Composition: ${composition.join(', ')}`;
      // immediate playback using static MP3s
      new Audio(`/static/my_app/sounds/${note}.mp3`).play();
    }
  
    function playComposition() {
      if (composition.length === 0) {
        return alert('Add some notes first!');
      }
  
      let index = 0;
      const player = document.getElementById('audio-player');  // Using the audio element in HTML
  
      // Function to play the next note in the composition
      function playNextNote() {
        if (index < composition.length) {
          const note = composition[index];
          player.src = `/static/my_app/sounds/${note}.mp3`;
          player.play();  // Play the audio file
          index++;  // Move to the next note
        }
      }
  
      // Play the first note
      playNextNote();
  
      // When the current note finishes, play the next one
      player.onended = function() {
        playNextNote();
      };
    }
  
    function newComposition() {
      composition = [];
      document.getElementById('composition').textContent = 'Current Composition: None';
      const player = document.getElementById('audio-player');
      player.pause();  // Stop any audio playing
      player.src = '';  // Clear the source
    }
  
    // Event listeners for the buttons
    document.getElementById('play-btn').addEventListener('click', playComposition);
    document.getElementById('new-btn').addEventListener('click', newComposition);
  </script>
  
  
  
</body>
</html>
